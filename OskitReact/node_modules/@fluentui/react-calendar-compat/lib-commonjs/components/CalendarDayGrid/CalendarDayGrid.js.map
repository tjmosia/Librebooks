{"version":3,"sources":["CalendarDayGrid.tsx"],"sourcesContent":["import * as React from 'react';\nimport { useArrowNavigationGroup } from '@fluentui/react-tabster';\nimport { useId } from '@fluentui/react-utilities';\nimport { getBoundedDateRange, getDateRangeArray, isRestrictedDate, DateRangeType, DayOfWeek } from '../../utils';\nimport { useCalendarDayGridStyles_unstable } from './useCalendarDayGridStyles.styles';\nimport { CalendarMonthHeaderRow } from './CalendarMonthHeaderRow';\nimport { CalendarGridRow } from './CalendarGridRow';\nimport { useWeeks } from './useWeeks';\nimport { useWeekCornerStyles, WeekCorners } from './useWeekCornerStyles.styles';\nimport { mergeClasses } from '@griffel/react';\nimport type { Day } from '../../utils';\nimport type { CalendarDayGridProps } from './CalendarDayGrid.types';\n\nexport interface DayInfo extends Day {\n  onSelected: () => void;\n  setRef(element: HTMLElement | null): void;\n}\n\nfunction useDayRefs() {\n  const daysRef = React.useRef<Record<string, HTMLElement>>({});\n\n  const getSetRefCallback = (dayKey: string) => (element: HTMLElement | null) => {\n    if (element === null) {\n      delete daysRef.current[dayKey];\n    } else {\n      daysRef.current[dayKey] = element;\n    }\n  };\n\n  return [daysRef, getSetRefCallback] as const;\n}\n\nfunction useAnimateBackwards(weeks: DayInfo[][]): boolean | undefined {\n  const previousNavigatedDateRef = React.useRef<Date | undefined>();\n  React.useEffect(() => {\n    previousNavigatedDateRef.current = weeks[0][0].originalDate;\n  });\n  const previousNavigatedDate = previousNavigatedDateRef.current;\n\n  if (!previousNavigatedDate || previousNavigatedDate.getTime() === weeks[0][0].originalDate.getTime()) {\n    return undefined;\n  } else if (previousNavigatedDate <= weeks[0][0].originalDate) {\n    return false;\n  } else {\n    return true;\n  }\n}\n\nexport const CalendarDayGrid: React.FunctionComponent<CalendarDayGridProps> = props => {\n  const navigatedDayRef = React.useRef<HTMLTableCellElement>(null) as React.MutableRefObject<HTMLTableCellElement>;\n\n  const activeDescendantId = useId();\n\n  const onSelectDate = (selectedDate: Date): void => {\n    const { firstDayOfWeek, minDate, maxDate, workWeekDays, daysToSelectInDayView, restrictedDates } = props;\n    const restrictedDatesOptions = { minDate, maxDate, restrictedDates };\n\n    let dateRange = getDateRangeArray(selectedDate, dateRangeType, firstDayOfWeek, workWeekDays, daysToSelectInDayView);\n    dateRange = getBoundedDateRange(dateRange, minDate, maxDate);\n\n    dateRange = dateRange.filter((d: Date) => {\n      return !isRestrictedDate(d, restrictedDatesOptions);\n    });\n\n    props.onSelectDate?.(selectedDate, dateRange);\n    props.onNavigateDate?.(selectedDate, true);\n  };\n\n  const [daysRef, getSetRefCallback] = useDayRefs();\n\n  const weeks = useWeeks(props, onSelectDate, getSetRefCallback);\n  const animateBackwards = useAnimateBackwards(weeks);\n  const [getWeekCornerStyles, calculateRoundedStyles] = useWeekCornerStyles(props);\n\n  React.useImperativeHandle(\n    props.componentRef,\n    () => ({\n      focus() {\n        navigatedDayRef.current?.focus?.();\n      },\n    }),\n    [],\n  );\n\n  /**\n   *\n   * Section for setting hover/pressed styles. Because we want arbitrary blobs of days to be selectable, to support\n   * highlighting every day in the month for month view, css :hover style isn't enough, so we need mouse callbacks\n   * to set classnames on all relevant child refs to apply the styling\n   *\n   */\n  const getDayInfosInRangeOfDay = (dayToCompare: DayInfo): DayInfo[] => {\n    // The hover state looks weird with non-contiguous days in work week view. In work week, show week hover state\n    const dateRangeHoverType = getDateRangeTypeToUse(props.dateRangeType, props.workWeekDays);\n\n    // gets all the dates for the given date range type that are in the same date range as the given day\n    const dateRange = getDateRangeArray(\n      dayToCompare.originalDate,\n      dateRangeHoverType,\n      props.firstDayOfWeek,\n      props.workWeekDays,\n      props.daysToSelectInDayView,\n    ).map((date: Date) => date.getTime());\n\n    // gets all the day refs for the given dates\n    const dayInfosInRange = weeks.reduce((accumulatedValue: DayInfo[], currentWeek: DayInfo[]) => {\n      return accumulatedValue.concat(\n        currentWeek.filter((weekDay: DayInfo) => dateRange.indexOf(weekDay.originalDate.getTime()) !== -1),\n      );\n    }, []);\n\n    return dayInfosInRange;\n  };\n\n  const getRefsFromDayInfos = (dayInfosInRange: DayInfo[]): (HTMLElement | null)[] => {\n    let dayRefs: (HTMLElement | null)[] = [];\n    dayRefs = dayInfosInRange.map((dayInfo: DayInfo) => daysRef.current[dayInfo.key]);\n\n    return dayRefs;\n  };\n\n  const {\n    gridLabel,\n    dateRangeType,\n    showWeekNumbers,\n    labelledBy,\n    lightenDaysOutsideNavigatedMonth,\n    animationDirection,\n  } = props;\n\n  const classNames = useCalendarDayGridStyles_unstable({\n    animateBackwards,\n    animationDirection,\n    dateRangeType,\n    lightenDaysOutsideNavigatedMonth:\n      lightenDaysOutsideNavigatedMonth === undefined ? true : lightenDaysOutsideNavigatedMonth,\n    showWeekNumbers,\n  });\n\n  // When the month is highlighted get the corner dates so that styles can be added to them\n  const weekCorners: WeekCorners = getWeekCornerStyles(weeks!);\n  const partialWeekProps = {\n    weeks,\n    navigatedDayRef,\n    calculateRoundedStyles,\n    activeDescendantId,\n    classNames,\n    weekCorners,\n    getDayInfosInRangeOfDay,\n    getRefsFromDayInfos,\n  } as const;\n\n  const arrowNavigationAttributes = useArrowNavigationGroup({ axis: 'grid' });\n\n  return (\n    <table\n      className={mergeClasses(classNames.table, props.className)}\n      aria-multiselectable=\"false\"\n      aria-label={gridLabel}\n      aria-labelledby={labelledBy}\n      aria-activedescendant={activeDescendantId}\n      role=\"grid\"\n      {...arrowNavigationAttributes}\n    >\n      <tbody>\n        <CalendarMonthHeaderRow {...props} classNames={classNames} weeks={weeks} />\n        <CalendarGridRow\n          {...props}\n          {...partialWeekProps}\n          week={weeks[0]}\n          weekIndex={-1}\n          rowClassName={classNames.firstTransitionWeek}\n          aria-role=\"presentation\"\n          ariaHidden={true}\n        />\n        {weeks!.slice(1, weeks!.length - 1).map((week: DayInfo[], weekIndex: number) => (\n          <CalendarGridRow\n            {...props}\n            {...partialWeekProps}\n            key={weekIndex}\n            week={week}\n            weekIndex={weekIndex}\n            rowClassName={classNames.weekRow}\n          />\n        ))}\n        <CalendarGridRow\n          {...props}\n          {...partialWeekProps}\n          week={weeks![weeks!.length - 1]}\n          weekIndex={-2}\n          rowClassName={classNames.lastTransitionWeek}\n          aria-role=\"presentation\"\n          ariaHidden={true}\n        />\n      </tbody>\n    </table>\n  );\n};\nCalendarDayGrid.displayName = 'CalendarDayGrid';\n\n/**\n * When given work week, if the days are non-contiguous, the hover states look really weird. So for non-contiguous\n * work weeks, we'll just show week view instead.\n */\nfunction getDateRangeTypeToUse(dateRangeType: DateRangeType, workWeekDays: DayOfWeek[] | undefined): DateRangeType {\n  if (workWeekDays && dateRangeType === DateRangeType.WorkWeek) {\n    const sortedWWDays = workWeekDays.slice().sort();\n    let isContiguous = true;\n    for (let i = 1; i < sortedWWDays.length; i++) {\n      if (sortedWWDays[i] !== sortedWWDays[i - 1] + 1) {\n        isContiguous = false;\n        break;\n      }\n    }\n\n    if (!isContiguous || workWeekDays.length === 0) {\n      return DateRangeType.Week;\n    }\n  }\n\n  return dateRangeType;\n}\n"],"names":["CalendarDayGrid","useDayRefs","daysRef","React","useRef","getSetRefCallback","dayKey","element","current","useAnimateBackwards","weeks","previousNavigatedDateRef","useEffect","originalDate","previousNavigatedDate","getTime","undefined","props","navigatedDayRef","activeDescendantId","useId","onSelectDate","selectedDate","firstDayOfWeek","minDate","maxDate","workWeekDays","daysToSelectInDayView","restrictedDates","restrictedDatesOptions","dateRange","getDateRangeArray","dateRangeType","getBoundedDateRange","filter","d","isRestrictedDate","onNavigateDate","useWeeks","animateBackwards","getWeekCornerStyles","calculateRoundedStyles","useWeekCornerStyles","useImperativeHandle","componentRef","focus","getDayInfosInRangeOfDay","dayToCompare","dateRangeHoverType","getDateRangeTypeToUse","map","date","dayInfosInRange","reduce","accumulatedValue","currentWeek","concat","weekDay","indexOf","getRefsFromDayInfos","dayRefs","dayInfo","key","gridLabel","showWeekNumbers","labelledBy","lightenDaysOutsideNavigatedMonth","animationDirection","classNames","useCalendarDayGridStyles_unstable","weekCorners","partialWeekProps","arrowNavigationAttributes","useArrowNavigationGroup","axis","createElement","table","className","mergeClasses","aria-multiselectable","aria-label","aria-labelledby","aria-activedescendant","role","tbody","CalendarMonthHeaderRow","CalendarGridRow","week","weekIndex","rowClassName","firstTransitionWeek","aria-role","ariaHidden","slice","length","weekRow","lastTransitionWeek","displayName","DateRangeType","WorkWeek","sortedWWDays","sort","isContiguous","i","Week"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}